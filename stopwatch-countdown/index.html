<!DOCTYPE html>
<html lang="en" data-locale="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <title>Online Stopwatch &amp; Countdown Timer | Tools Pack</title>
    <meta
      name="description"
      content="Precise stopwatch and countdown with start/pause/reset and alarm beep. Runs locally in your browser."
    />
    <meta name="theme-color" content="#1E1E2F" />

    <!-- Canonical & hreflang -->
    <link
      rel="canonical"
      href="https://tools-pack.netlify.app/stopwatch-countdown/"
    />
    <link
      rel="alternate"
      hreflang="en"
      href="https://tools-pack.netlify.app/stopwatch-countdown/"
    />
    <link
      rel="alternate"
      hreflang="bn"
      href="https://tools-pack.netlify.app/bn/stopwatch-countdown/"
    />
    <link
      rel="alternate"
      hreflang="x-default"
      href="https://tools-pack.netlify.app/stopwatch-countdown/"
    />

    <!-- Styles -->
    <link rel="stylesheet" href="/assets/style.css" />

    <!-- Open Graph / Twitter -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Tools Pack" />
    <meta
      property="og:title"
      content="Stopwatch &amp; Countdown — Tools Pack"
    />
    <meta
      property="og:description"
      content="Start, pause, reset; set countdown with alarm. Fast, private, in-browser."
    />
    <meta
      property="og:url"
      content="https://tools-pack.netlify.app/stopwatch-countdown/"
    />
    <meta property="og:locale" content="en_US" />
    <meta property="og:locale:alternate" content="bn_BD" />

    <!-- ✅ Prefer webp for OG (1200×630) -->
    <meta
      property="og:image"
      content="https://tools-pack.netlify.app/assets/og/stopwatch-countdown-en.webp"
    />
    <meta
      property="og:image:secure_url"
      content="https://tools-pack.netlify.app/assets/og/stopwatch-countdown-en.webp"
    />
    <meta property="og:image:type" content="image/webp" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta
      property="og:image:alt"
      content="Online Stopwatch &amp; Countdown — Tools Pack"
    />

    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="Stopwatch &amp; Countdown — Tools Pack"
    />
    <meta
      name="twitter:description"
      content="Accurate stopwatch and countdown with alarm — all in your browser."
    />
    <meta
      name="twitter:image"
      content="https://tools-pack.netlify.app/assets/og/stopwatch-countdown-en.webp"
    />

    <!-- AdSense: use ONE consistent client id across all ad units -->
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX"
      crossorigin="anonymous"
    ></script>

    <!-- JSON-LD: WebApplication (upgraded) -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "@id": "https://tools-pack.netlify.app/stopwatch-countdown/",
        "name": "Stopwatch & Countdown",
        "url": "https://tools-pack.netlify.app/stopwatch-countdown/",
        "image": "https://tools-pack.netlify.app/assets/og/stopwatch-countdown-en.webp",
        "applicationCategory": "Utility",
        "operatingSystem": "All",
        "inLanguage": "en",
        "isAccessibleForFree": true,
        "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
        "description": "Accurate stopwatch and countdown that run locally in your browser. Start, pause, reset, and alarm beep at zero."
      }
    </script>

    <!-- Structured data: Breadcrumbs -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Tools Pack",
            "item": "https://tools-pack.netlify.app/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Stopwatch & Countdown",
            "item": "https://tools-pack.netlify.app/stopwatch-countdown/"
          }
        ]
      }
    </script>

    <!-- Structured data: FAQ (MUST match visible content below) -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "How do I use the stopwatch?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Click Start to begin, Pause to pause, and Reset to clear. Keyboard: Space toggles Start/Pause, R resets."
            }
          },
          {
            "@type": "Question",
            "name": "How do I set a countdown?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Enter minutes and seconds, then click Start Countdown. You will hear a short beep when it reaches 00:00."
            }
          },
          {
            "@type": "Question",
            "name": "Will it stay accurate if I switch tabs?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes. The timer uses monotonic time and timestamps to avoid drift. The display stays accurate even if the tab is throttled."
            }
          },
          {
            "@type": "Question",
            "name": "Why can’t I hear the beep?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Most browsers block audio until you interact. Click anywhere first or press a button to unlock audio. Also check Silent mode and volume."
            }
          },
          {
            "@type": "Question",
            "name": "Are my timings or inputs saved?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "No data is sent to a server. Everything runs locally in your browser."
            }
          }
        ]
      }
    </script>
  </head>

  <body>
    <header class="sticky">
      <div class="wrap brand">
        <a href="/"><div class="logo" aria-label="Tools Pack"></div></a>
        <div>
          <h1 style="margin: 0">Stopwatch & Countdown</h1>
          <div class="sub">Precise timing</div>
        </div>
        <nav style="margin-left: auto">
          <a class="btn btn-ghost" href="/bn/stopwatch-countdown/" hreflang="bn"
            >বাংলা</a
          >
        </nav>
      </div>
    </header>

    <!-- Ad #1: top banner (constrained, no full-width expansion) -->
    <div class="wrap ad-wrap ad-top" aria-label="Advertisement">
      <span class="ad-label">Ad</span>
      <ins
        class="adsbygoogle"
        style="display: inline-block"
        data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
        data-ad-slot="1111111111"
        data-ad-format="auto"
        data-full-width-responsive="false"
      ></ins>
    </div>

    <main class="wrap">
      <!-- Breadcrumbs (updated for this tool) -->
      <nav class="breadcrumbs" aria-label="breadcrumb">
        <a href="/">Home</a> › <a href="/#time">Time Tools</a> ›
        <span aria-current="page">Stopwatch &amp; Countdown</span>
      </nav>

      <!-- TOC (updated anchors & labels) -->
      <p class="toc">
        <a href="#tool-time">Stopwatch &amp; Countdown</a> ·
        <a href="#how-to-use">How to use</a> · <a href="#faq">FAQ</a> ·
        <a href="#related">Related tools</a>
      </p>

      <!-- Tool -->
      <article class="card" id="tool-time">
        <div
          id="swDisp"
          class="field center"
          style="font-size: 28px; font-weight: 700"
          aria-live="polite"
        >
          00:00.000
        </div>

        <div class="row" style="gap: 0.5rem; justify-content: center">
          <button class="btn btn-primary" id="swStart" type="button">
            Start
          </button>
          <button class="btn" id="swPause" type="button">Pause</button>
          <button class="btn" id="swReset" type="button">Reset</button>
        </div>

        <div class="ad-wrap ad-article" aria-label="Advertisement">
          <span class="ad-label">Ad</span>
          <ins
            class="adsbygoogle"
            style="display: block; text-align: center"
            data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
            data-ad-slot="2222222222"
            data-ad-format="fluid"
            data-ad-layout="in-article"
          ></ins>
        </div>

        <hr style="border: none; border-top: var(--border)" />

        <form class="row" onsubmit="return false" aria-label="Countdown inputs">
          <label class="field" style="display: flex; flex-direction: column">
            <span class="muted" style="font-size: 0.9rem">Minutes</span>
            <input
              id="m"
              type="number"
              min="0"
              value="0"
              placeholder="Minutes"
              inputmode="numeric"
              autocomplete="off"
            />
          </label>
          <label class="field" style="display: flex; flex-direction: column">
            <span class="muted" style="font-size: 0.9rem">Seconds</span>
            <input
              id="s"
              type="number"
              min="0"
              max="59"
              value="30"
              placeholder="Seconds"
              inputmode="numeric"
              autocomplete="off"
            />
          </label>
        </form>

        <div class="row" style="gap: 0.5rem; justify-content: center">
          <button class="btn" id="cdStart" type="button">
            Start Countdown
          </button>
          <button class="btn" id="cdStop" type="button">Stop</button>
        </div>

        <div id="cdDisp" class="field center" aria-live="polite">00:30</div>
      </article>

      <!-- Stopwatch & Countdown: Details & Rules -->
      <article class="card" id="stopwatch-details">
        <h2>Stopwatch & Countdown Basics</h2>

        <div class="sw-grid">
          <div class="sw-section">
            <h3>What this tool can do</h3>
            <ul>
              <li>
                <strong>Stopwatch</strong>: start • pause • resume • reset •
                laps
              </li>
              <li>
                <strong>Countdown</strong>: set duration • start • pause •
                resume • reset
              </li>
              <li>
                <strong>Alarms</strong>: optional sound, vibration, and desktop
                notifications
              </li>
              <li>
                <strong>Precision</strong>: high-resolution timing with
                <code>performance.now()</code>
              </li>
            </ul>
            <p class="small muted">
              Runs entirely in your browser. No data leaves your device.
            </p>
          </div>

          <div class="sw-section">
            <h3>Modes</h3>
            <ul>
              <li><strong>Stopwatch</strong>: counts up from 00:00:00.000</li>
              <li>
                <strong>Countdown</strong>: counts down from a target (e.g.,
                25:00) to 00:00
              </li>
              <li>
                <strong>Auto-lap</strong> (optional): emit a lap every N
                seconds/minutes
              </li>
            </ul>
          </div>

          <div class="sw-section">
            <h3>Display & formatting</h3>
            <ul>
              <li>
                Format: <code>hh:mm:ss.mmm</code> or <code>mm:ss</code> for
                short timers
              </li>
              <li>Leading zeros for readability</li>
              <li>Lap table with split and delta times</li>
            </ul>
          </div>
        </div>

        <h3>Accuracy & drift</h3>
        <ul>
          <li>
            Uses a monotonic clock (<code>performance.now()</code>) to avoid
            system clock changes
          </li>
          <li>
            Renders with <code>requestAnimationFrame</code> but computes time
            from deltas (no setInterval drift)
          </li>
        </ul>
      </article>

      <!-- How to use -->
      <article class="card" id="how-to-use-stopwatch">
        <h2>How to use</h2>
        <ol>
          <li>
            Select <strong>Stopwatch</strong> or
            <strong>Countdown</strong> mode.
          </li>
          <li>
            For <em>Stopwatch</em>: press <strong>Start</strong>, use
            <strong>Lap</strong> anytime,
            <strong>Pause</strong>/<strong>Resume</strong>, then
            <strong>Reset</strong>.
          </li>
          <li>
            For <em>Countdown</em>: set hours/minutes/seconds, press
            <strong>Start</strong>. Optionally enable <strong>Sound</strong> /
            <strong>Vibrate</strong> / <strong>Notify</strong>.
          </li>
          <li>Keep the tab open; background tabs still keep accurate time.</li>
        </ol>

        <h3>Keyboard Shortcuts</h3>
        <ul>
          <li>
            <kbd>Space</kbd> Start/Pause • <kbd>L</kbd> Lap • <kbd>R</kbd> Reset
          </li>
          <li>
            Countdown: <kbd>↑/↓</kbd> adjust focused field •
            <kbd>Enter</kbd> Start/Pause
          </li>
        </ul>

        <h3>Tips</h3>
        <ul>
          <li>
            Enable “Keep screen awake” on mobile (if supported) for workouts.
          </li>
          <li>
            Allow notifications to get alerts when the countdown ends in
            background.
          </li>
          <li>Export laps as CSV (optional button) if you need logs.</li>
        </ul>
      </article>

      <!-- Real-World Applications -->
      <article class="card" id="stopwatch-applications">
        <h2>Where to Use Stopwatch & Countdown</h2>

        <div class="applications-grid">
          <div class="use-case">
            <h4>🏃 Training</h4>
            <p>Intervals, splits, rest timers</p>
            <span class="badge">laps</span>
          </div>

          <div class="use-case">
            <h4>🍳 Cooking</h4>
            <p>Multiple countdowns for recipes</p>
            <span class="badge">alerts</span>
          </div>

          <div class="use-case">
            <h4>⏳ Pomodoro</h4>
            <p>25/5 focus cycles</p>
            <span class="badge">auto-repeat</span>
          </div>

          <div class="use-case">
            <h4>🧪 Experiments</h4>
            <p>Accurate timing & logging</p>
            <span class="badge">monotonic</span>
          </div>
        </div>
      </article>

      <!-- Best Practices -->
      <article class="card" id="stopwatch-tips">
        <h2>Timing Best Practices</h2>

        <div class="tip">
          <h3>⏱ Prefer monotonic time</h3>
          <p>
            Compute elapsed time from <code>performance.now()</code> deltas, not
            Date.now().
          </p>
        </div>

        <div class="tip">
          <h3>🧭 Avoid interval drift</h3>
          <p>
            Use <code>requestAnimationFrame</code> (or a tight setInterval) but
            derive display from accumulated elapsed.
          </p>
        </div>

        <div class="tip">
          <h3>🔔 Graceful alerts</h3>
          <p>
            Fallback to vibration if audio blocked; show a banner via the
            Notifications API when permitted.
          </p>
        </div>

        <div class="tip">
          <h3>🔒 Battery & privacy</h3>
          <p>
            No telemetry. Alerts only after explicit user
            interaction/permission.
          </p>
        </div>
      </article>

      <!-- Technical Implementation -->
      <article class="card" id="stopwatch-technical">
        <h2>Technical Implementation</h2>

        <h3>Time formatting</h3>
        <pre><code class="language-javascript">function fmt(ms) {
  const sign = ms &lt; 0 ? "-" : "";
  ms = Math.abs(ms);
  const h = Math.floor(ms / 3600000);
  const m = Math.floor((ms % 3600000) / 60000);
  const s = Math.floor((ms % 60000) / 1000);
  const mm = ms % 1000;
  const hh = h.toString().padStart(2, "0");
  const m2 = m.toString().padStart(2, "0");
  const s2 = s.toString().padStart(2, "0");
  const ms3 = mm.toString().padStart(3, "0");
  return h ? `${sign}${hh}:${m2}:${s2}.${ms3}` : `${sign}${m2}:${s2}.${ms3}`;
}</code></pre>

        <h3>Stopwatch (accurate, pause/resume, laps)</h3>
        <pre><code class="language-javascript">class Stopwatch {
  constructor() { this.reset(); }
  reset() {
    this._running = false;
    this._start = 0;         // performance.now() at last start
    this._elapsed = 0;       // accumulated ms while paused
    this.laps = [];
  }
  start() {
    if (this._running) return;
    this._running = true;
    this._start = performance.now();
  }
  pause() {
    if (!this._running) return;
    this._elapsed += performance.now() - this._start;
    this._running = false;
  }
  toggle() { this._running ? this.pause() : this.start(); }
  valueMs() { return this._running ? this._elapsed + (performance.now() - this._start) : this._elapsed; }
  lap() {
    const t = this.valueMs();
    const prev = this.laps.length ? this.laps[this.laps.length - 1].total : 0;
    this.laps.push({ total: t, delta: t - prev });
    return this.laps[this.laps.length - 1];
  }
}</code></pre>

        <h3>Countdown (supports pause/resume, end alarm)</h3>
        <pre><code class="language-javascript">class Countdown {
  constructor(ms = 0) { this.set(ms); }
  set(ms) {
    this._duration = Math.max(0, ms);
    this._running = false;
    this._start = 0;
    this._elapsed = 0; // time spent running
  }
  start() {
    if (this._running) return;
    this._running = true;
    this._start = performance.now();
  }
  pause() {
    if (!this._running) return;
    this._elapsed += performance.now() - this._start;
    this._running = false;
  }
  toggle() { this._running ? this.pause() : this.start(); }
  remainingMs() {
    const run = this._running ? this._elapsed + (performance.now() - this._start) : this._elapsed;
    return Math.max(0, this._duration - run);
  }
  done() { return this.remainingMs() === 0; }
}</code></pre>

        <h3>Render loop (drift-free)</h3>
        <pre><code class="language-javascript">function runLoop(render) {
  let rafId;
  function frame() { render(); rafId = requestAnimationFrame(frame); }
  rafId = requestAnimationFrame(frame);
  return () => cancelAnimationFrame(rafId);
}
// Usage:
// const sw = new Stopwatch();
// const stop = runLoop(() =&gt; display.textContent = fmt(sw.valueMs()));</code></pre>

        <h3>Alarm: sound, vibration, notification</h3>
        <pre><code class="language-javascript">function beep(duration = 300, freq = 880, type = "sine") {
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const o = ctx.createOscillator(); const g = ctx.createGain();
  o.type = type; o.frequency.value = freq;
  o.connect(g); g.connect(ctx.destination);
  o.start(); g.gain.setValueAtTime(0.2, ctx.currentTime);
  o.stop(ctx.currentTime + duration/1000);
}

async function notify(title, body) {
  try {
    if (Notification.permission === "granted") {
      new Notification(title, { body });
    } else if (Notification.permission !== "denied") {
      const p = await Notification.requestPermission();
      if (p === "granted") new Notification(title, { body });
    }
  } catch {}
}

function vibrate(ms = 300) { if (navigator.vibrate) navigator.vibrate(ms); }</code></pre>

        <h3>Wire countdown to alarm</h3>
        <pre><code class="language-javascript">const cd = new Countdown(25 * 60 * 1000); // 25:00
let alarmed = false;
runLoop(() =&gt; {
  const left = cd.remainingMs();
  display.textContent = fmt(left);
  if (!alarmed &amp;&amp; left === 0) {
    alarmed = true;
    beep(400, 880); vibrate(400); notify("Timer done", "Countdown finished");
  }
});</code></pre>

        <h3>Persist last state (optional)</h3>
        <pre><code class="language-javascript">function saveState(key, data) { localStorage.setItem(key, JSON.stringify(data)); }
function loadState(key, fallback) {
  try { return JSON.parse(localStorage.getItem(key)) ?? fallback; } catch { return fallback; }
}</code></pre>
      </article>

      <!-- FAQ (SEO-friendly, human readable) -->
      <section class="faq-section card">
        <h2 class="faq-title">
          Stopwatch & Timer – Frequently Asked Questions
        </h2>

        <div class="faq-container">
          <!-- Stopwatch & Timer FAQs -->
          <div class="faq-item">
            <button class="faq-question">
              How do I use the stopwatch?
              <span class="faq-icon">+</span>
            </button>
            <div class="faq-answer">
              <p>
                Click Start to begin, Pause to pause, and Reset to clear the
                time. You can also use the keyboard: Space toggles Start/Pause
                and R resets.
              </p>
            </div>
          </div>

          <div class="faq-item">
            <button class="faq-question">
              How do I set up a countdown timer?
              <span class="faq-icon">+</span>
            </button>
            <div class="faq-answer">
              <p>
                Enter your desired minutes and seconds, then click Start
                Countdown (or press Enter). A beep will sound when the timer
                reaches zero.
              </p>
            </div>
          </div>

          <div class="faq-item">
            <button class="faq-question">
              Will the timer stay accurate if I switch tabs or minimize the
              browser?
              <span class="faq-icon">+</span>
            </button>
            <div class="faq-answer">
              <p>
                Yes. The stopwatch and countdown use precise system time to
                ensure accuracy, even if the browser tab is throttled or
                inactive.
              </p>
            </div>
          </div>

          <div class="faq-item">
            <button class="faq-question">
              Why can’t I hear the beep sound?
              <span class="faq-icon">+</span>
            </button>
            <div class="faq-answer">
              <p>
                Most browsers block audio until you interact with the page.
                Click anywhere or press a button to enable sound. Also check
                your volume and device’s Silent mode.
              </p>
            </div>
          </div>

          <div class="faq-item">
            <button class="faq-question">
              Does this tool save my timings or inputs?
              <span class="faq-icon">+</span>
            </button>
            <div class="faq-answer">
              <p>
                No. Everything runs locally in your browser. Nothing is uploaded
                or stored on a server.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Related tools (updated) -->
      <article class="card" id="related">
        <h2>Related tools</h2>
        <p class="muted">More time &amp; productivity utilities:</p>
        <p>
          <a class="btn" href="/age-calculator/">Age Calculator</a>
          <a class="btn" href="/calculator/">Calculator</a>
          <a class="btn" href="/quick-notes/">Quick Notes</a>
          <a class="btn" href="/text-to-pdf/">Text → PDF</a>
        </p>
        <p class="small">
          Prefer বাংলা? Try the
          <a href="/bn/stopwatch-countdown/" hreflang="bn">বাংলা সংস্করণ</a>.
        </p>
      </article>

      <!-- Bottom responsive ad -->
      <aside aria-label="advertisement" class="card" style="padding: 0">
        <ins
          class="adsbygoogle"
          style="display: block"
          data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
          data-ad-slot="3333333333"
          data-ad-format="auto"
          data-full-width-responsive="true"
        ></ins>
      </aside>
    </main>

    <footer>© <span id="y"></span> Tools Pack</footer>

    <script>
      // ---------- Utilities ----------
      const $ = (id) => document.getElementById(id);

      // Elements
      const yearEl = $("y");
      const swDisp = $("swDisp");
      const swStart = $("swStart");
      const swPause = $("swPause");
      const swReset = $("swReset");
      const minEl = $("m");
      const secEl = $("s");
      const cdStart = $("cdStart");
      const cdStop = $("cdStop");
      const cdDisp = $("cdDisp");

      yearEl.textContent = new Date().getFullYear();

      // ---------- Stopwatch ----------
      let swRAF = null;
      let swStartTS = 0; // performance.now() at (re)start
      let swElapsed = 0; // accumulated ms while paused/running

      const fmtMS = (ms) => {
        const m = Math.floor(ms / 60000);
        const s = Math.floor((ms % 60000) / 1000);
        const x = Math.floor(ms % 1000);
        return `${String(m).padStart(2, "0")}:${String(s).padStart(
          2,
          "0"
        )}.${String(x).padStart(3, "0")}`;
      };

      const swTick = () => {
        const now = performance.now();
        swDisp.textContent = fmtMS(swElapsed + (now - swStartTS));
        swRAF = requestAnimationFrame(swTick);
      };

      function swStartRun() {
        unlockAudio(); // prime audio on user gesture
        if (swRAF) return; // already running
        swStartTS = performance.now();
        swRAF = requestAnimationFrame(swTick);
      }

      function swPauseRun() {
        if (!swRAF) return;
        cancelAnimationFrame(swRAF);
        swRAF = null;
        swElapsed += performance.now() - swStartTS;
        swDisp.textContent = fmtMS(swElapsed);
      }

      function swResetRun() {
        if (swRAF) cancelAnimationFrame(swRAF);
        swRAF = null;
        swElapsed = 0;
        swDisp.textContent = "00:00.000";
      }

      swStart.onclick = swStartRun;
      swPause.onclick = swPauseRun;
      swReset.onclick = swResetRun;

      // ---------- Countdown (drift-free) ----------
      let cdTimer = null;
      let cdEndAt = 0; // epoch ms when countdown ends

      const fmtS = (t) => {
        const mm = String(Math.floor(t / 60)).padStart(2, "0");
        const ss = String(Math.max(0, Math.floor(t % 60))).padStart(2, "0");
        return `${mm}:${ss}`;
      };

      // Shared AudioContext (safer for autoplay policies)
      let ac = null;
      function unlockAudio() {
        const Ctx = window.AudioContext || window.webkitAudioContext;
        if (!Ctx) return;
        if (!ac) ac = new Ctx();
        if (ac.state === "suspended") {
          ac.resume().catch(() => {});
        }
      }

      function beep() {
        if (!ac) return; // no context, skip beep
        const o = ac.createOscillator();
        const g = ac.createGain();
        o.type = "sine";
        o.frequency.value = 880;
        o.connect(g);
        g.connect(ac.destination);
        const t0 = ac.currentTime;
        g.gain.setValueAtTime(0.0001, t0);
        g.gain.exponentialRampToValueAtTime(0.2, t0 + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.6);
        o.start(t0);
        o.stop(t0 + 0.65);
      }

      const cdUpdate = () => {
        const now = Date.now();
        const secondsLeft = Math.max(0, Math.ceil((cdEndAt - now) / 1000));
        cdDisp.textContent = fmtS(secondsLeft);
        if (secondsLeft <= 0) {
          clearInterval(cdTimer);
          cdTimer = null;
          beep();
        }
      };

      const reflectInputs = () => {
        const M = Math.max(0, parseInt(minEl.value || "0", 10));
        let S = Math.max(0, parseInt(secEl.value || "0", 10));
        if (S > 59) S = 59;
        secEl.value = String(S);
        cdDisp.textContent = fmtS(M * 60 + S);
      };
      minEl.addEventListener("input", reflectInputs);
      secEl.addEventListener("input", reflectInputs);
      reflectInputs();

      function cdStartRun() {
        unlockAudio();
        const M = Math.max(0, parseInt(minEl.value || "0", 10));
        const S = Math.max(0, Math.min(59, parseInt(secEl.value || "0", 10)));
        const total = M * 60 + S;
        if (total <= 0) return;

        if (cdTimer) clearInterval(cdTimer);
        cdEndAt = Date.now() + total * 1000 + 50; // tiny bias for first tick
        cdUpdate();
        cdTimer = setInterval(cdUpdate, 250);
      }

      function cdStopRun() {
        if (cdTimer) clearInterval(cdTimer);
        cdTimer = null;
      }

      cdStart.onclick = cdStartRun;
      cdStop.onclick = cdStopRun;

      // ---------- Keyboard shortcuts ----------
      window.addEventListener("keydown", (e) => {
        if (
          e.target &&
          (e.target.tagName === "INPUT" || e.target.isContentEditable)
        )
          return;

        if (e.code === "Space") {
          e.preventDefault();
          if (swRAF) swPauseRun();
          else swStartRun();
        } else if (e.key.toLowerCase() === "r") {
          swResetRun();
        } else if (e.key === "Enter") {
          cdStartRun();
        } else if (e.key === "Escape") {
          cdStopRun();
        }
      });

      // Unlock audio on first interaction anywhere
      window.addEventListener("pointerdown", unlockAudio, { once: true });

      // ---------- AdSense: init ALL ad units on the page ----------
      // Call push() once for each <ins.adsbygoogle>. This queues safely even if the lib isn't loaded yet.
      document.addEventListener("DOMContentLoaded", function () {
        window.adsbygoogle = window.adsbygoogle || [];
        document.querySelectorAll("ins.adsbygoogle").forEach(function () {
          window.adsbygoogle.push({});
        });
      });
    </script>

    <!-- Use absolute path so it works from nested routes like /stopwatch/ -->
    <script src="/assets/tracker.js" defer data-trk-site="tools-pack"></script>
    <script src="/assets/related-more.js" defer></script>
    <script src="/assets/script.js" defer></script>

    <noscript>
      <div class="wrap card">
        This page needs JavaScript for the timers and the ad slots.
      </div>
    </noscript>
  </body>
</html>
